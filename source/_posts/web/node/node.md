# Node

## 前言

这篇会写我这三年对 node 的理解，经历。

## 初识

最初认识 node,是搭建一个简单的 web 服务器。当然这也是当初设计 node 的目的，就是构建一个轻量的 web 服务器。
node :构建网络应用的一个框架，是 javascript 的运行平台

## 组成

js+v8+中间层（libuv）+网卡，硬盘

## 特点

- 异步 io

- 事件与回调函数
- 单线程
- 跨平台

## 异步 io

现实中 仍然是用线程池模拟

非阻塞

i/o 多路复用

- 轮询 不断重复 发 read
- select

https://www.zhihu.com/question/28594409

https://juejin.cn/post/6844903826999394311

事件循环

Tick->询问观察者是否是事件发生，执行相应的回调函数，

异步编程解决方案

事件发布订阅
promise/Deferred
流程控制库

## 内存管理

-v8 内存大小限制 ，大文件对象读取难 ，v8 限制内存的用量,
v8 的垃圾回收的限制，回收大内存文件，会花费很长时间，停止 js 线程

分代式垃圾回收机制，不同分代的内存使用不同的算法

新生（对象存活短）+老生（存活长，常驻内存对象）
复制方式的算法：（新生代使用）一分为二,将存活对象在两个空间之间来回复制

标记清除：内存空间会出现不连续的状态，-》标记整理运用而生

增量标记，延迟清理，增量式整理

buffer 对象不经过 V8 的内存分配

## 内存泄漏

- 缓存
- 队列消费不及时
- 作用域未释放

## 模块

## 大文件处理 stream createReadStream

## Buffer

c++层面请求内存， js 层分配内存

node 采用 slab 方式分配

8kb 界限，大对象 小对象

## redis 存 session

引入模块三步骤 路径分析-文件定位-编译执行

异步 io/ 同步 io

事件与事件之间相独立，如何协作通信是一个问题

## 起源

## node 究竟能干什么

这个点很关键，其实一直以来我对这个问题都报有疑惑，直到来到了秉理，才有了具体的认知。

- 充当一个 web 服务器
- 可做桥接 c/c++ ，扩充 js 调用系统平台的能力 （如：可封装一些 c/c++ 裤 ）
- 命令行工具 （node 提供了一些系统级 io 接口供调用）
- 发布脚本
- 打包工具

## 缺点

- 需要后端基础，如掌握不好，服务容易不稳定

## 框架

- nestjs

## 待深入

中间件
